doctype html
html(lang='en')
	head
		title Where is Sark?
		link(rel="stylesheet", type='text/css', href='styles/base.css')
	body
		h1 howdy peeps
		button#findSark Find Sark
		#map
		script.
			var data = !{JSON.stringify(data)};
			console.log(data);

			var pathCoordinates = []

			data.forEach(function(track){
				pathCoordinates.push({lat : track.lat, lng : track.long});
			});

			var lastCoordinate = {lat: data[data.length-1].lat , lng : data[data.length-1].long}

			var map;
			function initMap() {
				map = new google.maps.Map(document.getElementById('map'), {
					//- center: {lat: 39.8275062, lng: -98.5810004}, //center of the USA
					center: lastCoordinate,
					zoom: 5
				});
				var trackPath = new google.maps.Polyline({
					path: pathCoordinates,
					geodesic: true,
					strokeColor: '#FF0000',
					strokeOpacity: 1.0,
					strokeWeight: 2
				});

				trackPath.setMap(map);

				function smoothZoom (map, max, cnt) {
					if (cnt >= max) {
						return;
					}
					else {
						z = google.maps.event.addListener(map, 'zoom_changed', function(event){
							google.maps.event.removeListener(z);
							smoothZoom(map, max, cnt + 1);
						});
						setTimeout(function(){map.setZoom(cnt)}, 100);
					}
				}
				
				var findSarkButton = document.getElementById('findSark');
				findSarkButton.addEventListener('click', function(event){
					map.setCenter(lastCoordinate);
					smoothZoom(map, 17, map.getZoom());
				});

			}//end initMap

		script(async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA7wQGap3Amizz3yvTwdsic5hgTZAPpZ8&callback=initMap")
